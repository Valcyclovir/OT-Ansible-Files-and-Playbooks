---

# This is a collection of monitors to check various states at regular scheduled intervals.
# Monitors performed:
#  Check for bids last 15 minutes
#
#

- name: Install Monitors
  hosts: all
  gather_facts: no

  tasks:
    - name: Create directories
      file:
        path: /root/OT-Ansible-Files-and-Playbooks/manage/data
        state: directory
        mode: '0755'

    - name: Create directories
      file:
        path: /root/OT-Ansible-Files-and-Playbooks/manage/ubuntu/data
        state: directory
        mode: '0755'

    - name: Install send.sh
      copy:
        src: ~/OT-Ansible-Files-and-Playbooks/manage/data/send.sh
        dest: /root/OT-Ansible-Files-and-Playbooks/manage/data/send.sh
        owner: root
        group: root
        mode: '0700'

    - name: Install config.sh
      copy:
        src: ~/OT-Ansible-Files-and-Playbooks/manage/data/config.sh
        dest: /root/OT-Ansible-Files-and-Playbooks/manage/data/config.sh
        owner: root
        group: root
        mode: '0600'

    - name: Install bid check monitor
      copy:
        src: ~/OT-Ansible-Files-and-Playbooks/manage/ubuntu/data/bid_check.sh
        dest: /root/OT-Ansible-Files-and-Playbooks/manage/ubuntu/data/bid_check.sh
        owner: root
        group: root
        mode: '0700'

    - name: Delete existing monitor (bid check) schedule from cron
      cron:
        name: Monitor Bid Check
        state: absent

    - name: Add monitor (bid check) schedule to cron (every 15 minutes)
      cron:
        name: Monitor Bid Check
        minute: "*/15"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "/root/OT-Ansible-Files-and-Playbooks/manage/ubuntu/data/bid_check.sh"
